(this["webpackJsonpexcalidraw-claymate"]=this["webpackJsonpexcalidraw-claymate"]||[]).push([[0],{141:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(23),c=n.n(r),o=(n(47),n(2)),l=n(7),u=n.n(l),d=(n(71),n(5)),s=n(1),m=n.n(s),f=n(4),b=n(3),g=n(39),p=(n(72),n(8)),v=n(40),h=n.n(v),y=function(e){return new Promise((function(t){var n=new h.a;e.forEach((function(t,a){var i=a+1===e.length;n.addFrame(t.imageData,{delay:i?2e3:500})})),n.on("finished",(function(e){Object(p.a)(e,{fileName:"excalidraw-claymate.gif"}).then(t)})),n.render()}))},w=n(25),O=function(e){return e.filter((function(e){return!e.isDeleted}))},x=function(){var e=Object(f.a)(m.a.mark((function e(t,n){var a,i,r,c;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a='<!DOCTYPE html>\n    <html lang="en">\n      <style>\n        svg { width: 100%; height: 100%; }\n        body { margin: 0px; font-size: 24px; }\n        button { background: transparent; border: none; cursor: pointer; padding: 3px; margin: 0px 10px; font-size: inherit;}\n        #container { display: flex; flex-direction: column; height: 100%; }\n        #navigation { display: flex; justify-content: center; align-items: center; padding: 5px; border-top: 1px solid lightgray; background: white; }        \n        #rightbuttons { position: absolute; right: 10px; display: flex;  }\n        #slides { height: calc(100vh - 50px); }                \n      </style>\n      <script>\n        let index = 0;\n        let totalScenes = '.concat(t.length,"\n        function updateTitle() {\n          document.getElementById('title').innerText = '' + (index + 1) + ' of ' + totalScenes;\n        }\n        function moveLeft() {\n          if (index > 0) {\n            document.getElementById('scene' + index).style.display = 'none';\n            index -= 1;\n            document.getElementById('scene' + index).style.display = 'block';\n            updateTitle();\n            document.getElementById('scene' + index).setCurrentTime(0);\n          }\n        }\n        function moveRight() {\n          if (index < totalScenes - 1) {\n            document.getElementById('scene' + index).style.display = 'none';\n            index += 1;\n            document.getElementById('scene' + index).style.display = 'block';\n            updateTitle();\n            document.getElementById('scene' + index).setCurrentTime(0);\n          }\n        }\n        function closeNavigation() {\n          document.getElementById('navigation').style.display = 'none';\n          document.getElementById('slides').style.height = '100vh'\n        }\n        function toggleMaximise() {\n          if (document.fullscreenElement === document.body) {\n            document.exitFullscreen();\n          } else {\n            document.body.requestFullscreen();\n          }\n        }\n        document.addEventListener('DOMContentLoaded', () => {\n          document.getElementById('scene' + index).style.display = 'block';\n          document.getElementById('scene' + index).setCurrentTime(0);\n        });\n        document.addEventListener('keydown', (event) => {\n          if (event.key === 'ArrowRight') {\n            moveRight();\n          }\n          if (event.key === 'ArrowLeft') {\n            moveLeft();\n          }\n          if (event.key.toLowerCase() === 'f') {\n            toggleMaximise();            \n          }\n        });\n      <\/script>\n      <body>\n      <div id=\"container\">\n      <div id=\"slides\">\n  "),i=0;case 2:if(!(i<t.length)){e.next=14;break}return r=t[i],e.next=6,Object(l.exportToSvg)(r.drawing);case 6:c=e.sent,n.animate&&Object(w.a)(c,O(r.drawing.elements),n.animateOptions),c.id="scene".concat(i),c.style.display="none",a+=c.outerHTML;case 11:++i,e.next=2;break;case 14:return a+='</div>\n            <div id="navigation">\n              <button class="navbutton" type="button" onClick="moveLeft()" title="Previous slide">&#9664;</button>\n              <div id="title">1 of '.concat(t.length,'</div>\n              <button class="navbutton" type="button" onClick="moveRight()" title="Next slide">&#9654;</button>          \n              <div id="rightbuttons">\n                <button type="button" onClick="toggleMaximise()" title="Toggle full-screen">&#x26F6;</button>\n                <button type="button" onClick="closeNavigation()" title="Close this panel">&#x2716;</button>\n              <div>\n            </div>\n        </div></body></html>'),e.next=17,Object(p.a)(new Blob([a],{type:"text/html"}),{fileName:"excalidraw-claymate.html"});case 17:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),E=function(){var e=Object(f.a)(m.a.mark((function e(t,n,a){var i,r,c,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(l.exportToSvg)(t.drawing);case 2:i=e.sent,n.animate&&Object(w.a)(i,O(t.drawing.elements),n.animateOptions),r=i.outerHTML,a?(c=document.getElementById(a))&&(c.innerHTML=r):(o=window.open("","_blank"))&&(o.document.body.innerHTML=r);case 6:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),j=(n(73),function(e,t){var n=e.match(new RegExp("".concat(t,":(-?\\d+)")));return null===n?void 0:Number(n[1])||0}),C=function(e,t,n,a){var i=Object(o.a)({},e.appState.selectedElementIds);return{elements:e.elements.map((function(e){var r,c=e.id;return t.includes(c)?(r=c.match(new RegExp("".concat(n,":(-?\\d+)")))?c.replace(new RegExp("".concat(n,":(-?\\d+)")),"".concat(n,":").concat(a)):c+"-".concat(n,":").concat(a),c===r?e:(i[r]=i[c],delete i[c],Object(o.a)(Object(o.a)({},e),{},{id:r}))):e})),appState:Object(o.a)(Object(o.a)({},e.appState),{},{selectedElementIds:i})}},k=function(e){var t,n,a=e.animateEnabled,r=e.setAnimateEnabled,c=e.scene,l=e.updateDrawing,u=e.animateOptions,d=e.setAnimateOptions,s=e.previewCurrentScene,m=null!==(t=null===c||void 0===c?void 0:c.drawing.elements)&&void 0!==t?t:[],f=c?Object.keys(null!==(n=c.drawing.appState.selectedElementIds)&&void 0!==n?n:{}).filter((function(e){return c.drawing.appState.selectedElementIds[e]&&m.some((function(t){return t.id===e}))})):[],b=new Set;f.forEach((function(e){b.add(j(e,"animateOrder"))}));var g=!a||!b.size,p=new Set;f.forEach((function(e){p.add(j(e,"animateDuration"))}));var v=!a||!p.size;return i.a.createElement("div",{className:"AnimateConfig"},i.a.createElement("div",null,i.a.createElement("label",null,i.a.createElement("input",{type:"checkbox",checked:a,onChange:function(){return r((function(e){return!e}))}}),"Enable animate")," ",i.a.createElement("button",{disabled:!a,onClick:s},"Preview")),i.a.createElement("div",{style:{opacity:g?.3:1}},"Animate order:"," ",b.size>1?i.a.createElement(i.a.Fragment,null,"(mixed)"):i.a.createElement("input",{disabled:g,value:1===b.size&&b.values().next().value||0,onChange:function(e){var t=Math.floor(Number(e.target.value));c&&Number.isFinite(t)&&l(C(c.drawing,f,"animateOrder",t))},type:"number",style:{width:40}})),i.a.createElement("div",{style:{opacity:v?.3:1}},"Animate duration (ms):"," ",p.size>1?i.a.createElement(i.a.Fragment,null,"(mixed)"):i.a.createElement("input",{disabled:v,value:1===p.size&&p.values().next().value||"",onChange:function(e){var t=Math.floor(Number(e.target.value));c&&Number.isFinite(t)&&l(C(c.drawing,f,"animateDuration",t))},placeholder:"Default",style:{width:50}})),i.a.createElement("div",{style:{opacity:a?1:.3}},"Animate pointer:"," ",i.a.createElement("input",{disabled:!a,value:u.pointerImg||"",onChange:function(e){d((function(t){return Object(o.a)(Object(o.a)({},t),{},{pointerImg:e.target.value})}))},placeholder:"URL...",style:{width:50}})," ",i.a.createElement("label",{className:"AnimateConfig-button-like ".concat(a?"AnimateConfig-button-like-enabled":"AnimateConfig-button-like-disabled")},i.a.createElement("input",{disabled:!a,type:"file",accept:"image/*",onChange:function(e){var t=e.target.files&&e.target.files[0];if(t){var n=new FileReader;n.onload=function(){if("string"===typeof n.result){var e=n.result;d((function(t){return Object(o.a)(Object(o.a)({},t),{},{pointerImg:e})}))}},n.readAsDataURL(t)}},style:{width:0}}),"File")),i.a.createElement("div",{style:{opacity:a?1:.3}},"(Pointer width:"," ",i.a.createElement("input",{disabled:!a,value:u.pointerWidth||"",onChange:function(e){d((function(t){return Object(o.a)(Object(o.a)({},t),{},{pointerWidth:e.target.value})}))},placeholder:"Num...",style:{width:50}}),")"))},S=Object(a.memo)((function(e){var t=e.scene,n=Object(a.useRef)(null);return Object(a.useEffect)((function(){if(n.current){var e=n.current.getContext("2d");e&&e.putImageData(t.imageData,0,0)}}),[t]),i.a.createElement("canvas",{ref:n,width:t.width,height:t.height})})),I=function(e){var t=e.scenes,n=e.currentIndex,r=e.updateScenes,c=e.moveToScene,o=e.addScene,l=e.updateDrawing,u=Object(a.useState)(!1),s=Object(b.a)(u,2),p=s[0],v=s[1],h=Object(a.useState)(!1),w=Object(b.a)(h,2),O=w[0],j=w[1],C=Object(a.useState)({}),I=Object(b.a)(C,2),N=I[0],T=I[1],D=function(){var e=Object(f.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y(t);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),L=function(){var e=Object(f.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(t,{animate:O,animateOptions:N});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),M=function(){var e=Object(f.a)(m.a.mark((function e(){var a,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n){e.next=7;break}return a="",(i=document.getElementById("previewOuter"))&&(a="previewInner"),e.next=6,E(t[n],{animate:O,animateOptions:N},a);case 6:i&&(i.style.display="block");case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){0===t.length&&o()}),[t,o]),i.a.createElement("div",{className:"Claymate"},i.a.createElement("div",{className:"Claymate-scenes"},t.map((function(e,a){var o="MissingId";return Object(g.isEmpty)(t[a].drawing.elements)||(o=t[a].drawing.elements[0].id),i.a.createElement("div",{key:e.id,className:"Claymate-scene ".concat(a===n?"Claymate-current-scene":""),onClick:function(){return c(a)},"data-testid":o},i.a.createElement(S,{scene:e}),i.a.createElement("button",{type:"button",className:"Claymate-delete","aria-label":"Delete",disabled:t.length<=1,onClick:function(a){a.stopPropagation(),function(e){var a=t.findIndex((function(t){return t.id===e}));if(a>=0){var i=t.length-1;if(i>0){var c;if(void 0!==n){var o=a===n;if(n>a||o){var l=n;o&&(n===i?l=n-1:0===n&&(l=1)),c={index:n>0?n-1:n,drawing:t[l].drawing}}}r((function(t){return t.filter((function(t){return t.id!==e}))}),c)}}}(e.id)}},"\u2716"),i.a.createElement("button",{type:"button",className:"Claymate-left","aria-label":"Move Left",disabled:0===a,onClick:function(n){n.stopPropagation(),function(e){var n=t.findIndex((function(t){return t.id===e}));r((function(e){var t=Object(d.a)(e);return t[n-1]=e[n],t[n]=e[n-1],t}),{index:n-1,drawing:t[n].drawing})}(e.id)}},"\u2b05"),i.a.createElement("button",{type:"button",className:"Claymate-right","aria-label":"Move Right",disabled:a===t.length-1,onClick:function(n){n.stopPropagation(),function(e){var n=t.findIndex((function(t){return t.id===e}));r((function(e){var t=Object(d.a)(e);return t[n+1]=e[n],t[n]=e[n+1],t}),{index:n+1,drawing:t[n].drawing})}(e.id)}},"\u27a1"))}))),i.a.createElement("div",{className:"Claymate-configs"},p&&i.a.createElement(k,{animateEnabled:O,setAnimateEnabled:j,scene:void 0===n?void 0:t[n],updateDrawing:l,animateOptions:N,setAnimateOptions:T,previewCurrentScene:M})),i.a.createElement("div",{className:"Claymate-buttons"},i.a.createElement("button",{type:"button",onClick:o},"Add scene"),i.a.createElement("button",{type:"button",onClick:D,disabled:0===t.length},"Export GIF"),i.a.createElement("div",null,i.a.createElement("button",{type:"button",onClick:function(){return v((function(e){return!e}))}},p?i.a.createElement(i.a.Fragment,null,"\u25b8"):i.a.createElement(i.a.Fragment,null,"\u25c2")),i.a.createElement("button",{type:"button",onClick:function(){return L()},disabled:0===t.length},"Export HTML")),i.a.createElement("button",{type:"button",onClick:function(){r((function(e){return Object(d.a)(e).reverse()}),void 0!==n?{index:t.length-1-n,drawing:t[n].drawing}:void 0)},disabled:t.length<=1},"Reverse order")))},N=n(24),T=n.n(N),D=n(41),L=function(e,t){var n=Object(l.exportToCanvas)({elements:e.elements}),a=t?t.width:n.width,i=t?t.height:n.height;if(a&&i){var r=n.getContext("2d");return r?{id:Object(D.a)(),width:a,height:i,imageData:r.getImageData(0,0,a,i),drawing:e}:void 0}},M=function(){try{var e,t=JSON.parse(localStorage.getItem("claymate-scenes")||"");if(t&&t.length>0)return t.map((function(t){t.appState.collaborators=new Map;var n=L(t,e?{width:e.width,height:e.height}:void 0);return void 0===e&&(e=n),n}))}catch(i){try{var n=function(){try{var e=JSON.parse(localStorage.getItem("excalidraw-elements")||"");return e.appState.collaborators=new Map,e}catch(t){return null}}();if(n){var a=L(n);if(a)return[a]}}catch(r){}}return null},A=function(){var e=Object(a.useState)(!1),t=Object(b.a)(e,2),n=t[0],i=t[1],r=Object(a.useState)(0),c=Object(b.a)(r,2),l=c[0],u=c[1],s=Object(a.useState)(0),m=Object(b.a)(s,2),f=m[0],g=m[1],p=Object(a.useState)([]),v=Object(b.a)(p,2),h=v[0],y=v[1],w=Object(a.useState)(),O=Object(b.a)(w,2),x=O[0],E=O[1];Object(a.useEffect)((function(){if(!n){var e=M();e&&e.length>0&&(y(e),g(0),E(e[0].drawing))}}),[n,i]),Object(a.useEffect)((function(){!function(e){var t=JSON.stringify(e.map((function(e){return e.drawing})));localStorage.setItem("claymate-scenes",t)}(h)}),[h]);var j,C,k=Object(a.useCallback)((function(e){u((function(e){return e+1})),E(e)}),[]),S=Object(a.useCallback)((function(e){k(h[e].drawing),g(e)}),[k,g,h]),I=Object(a.useCallback)((function(e,t){y(e),t&&(k(t.drawing),g(t.index))}),[g,k,y]),N=void 0!==f&&f<h.length?Object(o.a)(Object(o.a)({},h[f]),{},{drawing:x}):void 0;null!=N&&1!==h.length&&(j=N.width,C=N.height),Object(a.useEffect)((function(){if(null!=f&&x){var e=L(x,void 0===j||void 0===C?void 0:{width:j,height:C});e&&I((function(t){var n=Object(d.a)(t);return n[f]=e,n}),void 0)}}),[x,f,h.length,I,j,C]);var D=Object(a.useCallback)((function(){if(x){var e=L(x,h[0]&&{width:h[0].width,height:h[0].height});e&&I((function(t){return[].concat(Object(d.a)(t),[e])}),{index:h.length,drawing:x})}}),[I,h,x]);return{initialised:n,moveToScene:S,addScene:D,onChange:function(e,t){if(null==x||!T()(e,x.elements)||!T()(t,x.appState)){var n={elements:e.map((function(e){return Object(o.a)({},e)})),appState:Object(o.a)({},t)};E(n)}},drawingVersion:l,currentIndex:f,scenes:h,updateScenes:I,initialData:x}},B=function(){var e=Object(a.useMemo)((function(){return function(){try{var e=localStorage.getItem("claymate-libraries"),t=e?JSON.parse(e):void 0;if(t)return t}catch(n){console.error("Unable to load libraries",n)}}()}),[]),t=Object(a.useRef)(e);return{onLibraryChange:Object(a.useCallback)((function(e){!function(e){var t=JSON.stringify(e);localStorage.setItem("claymate-libraries",t)}(e),t.current=e}),[]),libraryItems:t.current}},R=function(){var e=Object(a.useRef)(null),t=A(),n=t.moveToScene,r=t.addScene,c=t.onChange,l=t.drawingVersion,d=t.currentIndex,s=t.initialData,m=t.scenes,f=t.updateScenes,b=B(),g=b.onLibraryChange,p=b.libraryItems,v=Object(a.useMemo)((function(){return p?Object(o.a)(Object(o.a)({},s),{},{libraryItems:p}):s}),[s,p]);return i.a.createElement("div",{className:"ClaymateApp"},i.a.createElement(u.a,{ref:e,key:l,initialData:v,onChange:c,onLibraryChange:g}),i.a.createElement(I,{scenes:m,currentIndex:d,updateScenes:f,moveToScene:n,addScene:r,updateDrawing:function(t){var n;null===(n=e.current)||void 0===n||n.updateScene(t)}}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(R,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},42:function(e,t,n){e.exports=n(141)},47:function(e,t,n){},71:function(e,t,n){},72:function(e,t,n){},73:function(e,t,n){}},[[42,1,2]]]);
//# sourceMappingURL=main.7a6ce947.chunk.js.map