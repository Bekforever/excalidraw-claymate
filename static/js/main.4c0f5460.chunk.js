(this["webpackJsonpexcalidraw-claymate"]=this["webpackJsonpexcalidraw-claymate"]||[]).push([[0],{143:function(e,t,n){"use strict";n.r(t);var a=n(2),i=n(27),r=n.n(i),c=(n(48),n(3)),o=n(6),s=n.n(o),u=(n(72),n(7)),d=n(1),l=n.n(d),m=n(5),b=n(4),f=n(41),g=(n(73),n(9)),p=n(42),v=n.n(p),h=function(e){return new Promise((function(t){var n=new v.a;e.forEach((function(t,a){var i=a+1===e.length;n.addFrame(t.imageData,{delay:i?2e3:500})})),n.on("finished",(function(e){Object(g.a)(e,{fileName:"excalidraw-claymate.gif"}).then(t)})),n.render()}))},j=n(20),x=function(e){return e.filter((function(e){return!e.isDeleted}))},O=function(){var e=Object(m.a)(l.a.mark((function e(t,n){var a,i,r,s,u,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a='<!DOCTYPE html>\n    <html lang="en">\n      <style>\n        svg { width: 100%; height: 100%; }\n        body { margin: 0px; font-size: 24px; '.concat(n.darkMode?"filter: ".concat("invert(93%) hue-rotate(180deg)","; "):"","}\n        button { background: transparent; border: none; cursor: pointer; padding: 3px; margin: 0px 10px; font-size: inherit;}\n        #container { display: flex; flex-direction: column; height: 100%; background: white; }\n        #navigation { display: flex; justify-content: center; align-items: center; padding: 5px; border-top: 1px solid lightgray; background: white; }\n        #leftbuttons { position: absolute; left: 10px; display: flex; }\n        #rightbuttons { position: absolute; right: 10px; display: flex; }\n        #slides { height: calc(100vh - 50px); }\n      </style>\n      <script>\n        let index = 0;\n        let totalScenes = ").concat(t.length,"\n        function updateTitle() {\n          document.getElementById('title').innerText = '' + (index + 1) + ' of ' + totalScenes;\n        }\n        function moveLeft() {\n          if (index > 0) {\n            document.getElementById('scene' + index).style.display = 'none';\n            index -= 1;\n            document.getElementById('scene' + index).style.display = 'block';\n            updateTitle();\n            document.getElementById('scene' + index).setCurrentTime(0);\n          }\n        }\n        function moveRight() {\n          if (index < totalScenes - 1) {\n            document.getElementById('scene' + index).style.display = 'none';\n            index += 1;\n            document.getElementById('scene' + index).style.display = 'block';\n            updateTitle();\n            document.getElementById('scene' + index).setCurrentTime(0);\n          }\n        }\n        function closeNavigation() {\n          document.getElementById('navigation').style.display = 'none';\n          document.getElementById('slides').style.height = '100vh'\n        }\n        function toggleMaximise() {\n          if (document.fullscreenElement === document.body) {\n            document.exitFullscreen();\n          } else {\n            document.body.requestFullscreen();\n          }\n        }\n        ").concat((l=!!n.animate,l?"\n      function togglePausedAnimations() {\n        const svg = document.getElementById('scene' + index);\n        if (svg.animationsPaused()) {\n          for (const svg of document.getElementsByTagName('svg')) {\n            svg.unpauseAnimations();\n          }\n        } else {\n          for (const svg of document.getElementsByTagName('svg')) {\n            svg.pauseAnimations();\n          }\n        }\n      }\n      const beginTimeLists = [];\n      let animateTimer;\n      function stepForwardAnimations() {\n        const svg = document.getElementById('scene' + index);\n        const beginTimeList = beginTimeLists[index];\n        const currentTime = svg.getCurrentTime() * 1000;\n        let nextTime = beginTimeList.find((t) => t > currentTime + 50);\n        console.log(currentTime, beginTimeList, nextTime);\n        if (nextTime) {\n          nextTime -= 1;\n        } else {\n          nextTime = currentTime + 500;\n        }\n        clearTimeout(animateTimer);\n        svg.unpauseAnimations();\n        animateTimer = setTimeout(() => {\n          svg.pauseAnimations();\n          svg.setCurrentTime(nextTime / 1000);\n        }, nextTime - currentTime);\n      }\n      function resetAnimations() {\n        const svg = document.getElementById('scene' + index);\n        svg.setCurrentTime(0);\n      }\n":"\n      function togglePausedAnimations() {}\n      function stepForwardAnimations() {}\n      function resetAnimations() {}\n"),"\n        ").concat("\n  function startRecording() {\n    import('https://unpkg.com/browser-fs-access').then(({ fileSave }) => {\n      navigator.mediaDevices.getDisplayMedia({\n        video: { displaySurface: 'browser' },\n      }).then(function(stream) {\n        navigator.mediaDevices.getUserMedia({\n          audio: true,\n        }).catch(() => null).then(function(audioStream) {\n          if (audioStream) {\n            const audioTrack = audioStream.getAudioTracks()[0];\n            stream.getVideoTracks()[0].onended = () => {\n              audioTrack.stop();\n            };\n            stream.addTrack(audioTrack);\n          }\n          const recorder = new MediaRecorder(stream);\n          recorder.ondataavailable = (e) => {\n            const blob = new Blob([e.data], { type: \"video/webm\" });\n            const opts = { fileName: \"video.webm\", extensions: [\".webm\"] };\n            fileSave(blob, opts).catch(() => {\n              document.getElementById('startrecordingbutton').onclick = () => {\n                fileSave(blob, opts);\n              };\n              window.alert('Click the recording button again to save file');\n            });\n          };\n          recorder.start();\n        });\n      });\n    });\n  }\n","\n        document.addEventListener('DOMContentLoaded', () => {\n          document.getElementById('scene' + index).style.display = 'block';\n          document.getElementById('scene' + index).setCurrentTime(0);\n        });\n        document.addEventListener('keydown', (event) => {\n          if (event.key === 'ArrowRight') {\n            moveRight();\n          }\n          if (event.key === 'ArrowLeft') {\n            moveLeft();\n          }\n          if (event.key.toLowerCase() === 'f') {\n            toggleMaximise();\n          }\n          if (event.key.toLowerCase() === 'p') {\n            togglePausedAnimations();\n          }\n          if (event.key.toLowerCase() === 's') {\n            stepForwardAnimations();\n          }\n          if (event.key.toLowerCase() === 'r') {\n            resetAnimations();\n          }\n        });\n      <\/script>\n      <body>\n      <div id=\"container\">\n      <div id=\"slides\">\n  "),i=0;case 2:if(!(i<t.length)){e.next=15;break}return r=t[i],e.next=6,Object(o.exportToSvg)(Object(c.a)(Object(c.a)({},r.drawing),{},{appState:Object(c.a)(Object(c.a)({},r.drawing.appState),{},{exportWithDarkMode:!1})}));case 6:s=e.sent,n.animate&&Object(j.a)(s,x(r.drawing.elements),n.animateOptions),s.id="scene".concat(i),s.style.display="none",a+=s.outerHTML,n.animate&&((u=Object(j.b)(s)).sort((function(e,t){return e-t})),a+="\n        <script>\n          beginTimeLists.push(".concat(JSON.stringify(u),");\n        <\/script>\n      "));case 12:++i,e.next=2;break;case 15:return d=n.animate?'\n    <div id="leftbuttons">\n     <button type="button" onclick="togglePausedAnimations()" title="Play or pause animations">P</button>\n     <button type="button" onclick="stepForwardAnimations()" title="Step forward animations">S</button>\n     <button type="button" onclick="resetAnimations()" title="Reset animations">R</button>\n    </div>\n':"",a+='\n    </div>\n    <div id="navigation">\n      '.concat(d,'\n      <button class="navbutton" type="button" onclick="moveLeft()" title="Previous slide">&#9664;</button>\n      <div id="title">1 of ').concat(t.length,'</div>\n      <button class="navbutton" type="button" onclick="moveRight()" title="Next slide">&#9654;</button>\n      <div id="rightbuttons">\n        <button type="button" onclick="startRecording()" title="Start recording" id="startrecordingbutton">&#x1F3A5;</button>\n        <button type="button" onclick="toggleMaximise()" title="Toggle full-screen">&#x26F6;</button>\n        <button type="button" onclick="closeNavigation()" title="Close this panel">&#x2716;</button>\n      </div>\n    </div>\n  </div></body></html>\n'),e.next=19,Object(g.a)(new Blob([a],{type:"text/html"}),{fileName:"excalidraw-claymate.html"});case 19:case"end":return e.stop()}var l}),e)})));return function(t,n){return e.apply(this,arguments)}}(),y=function(){var e=Object(m.a)(l.a.mark((function e(t,n,a){var i,r,c,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(o.exportToSvg)(t.drawing);case 2:i=e.sent,n.animate&&Object(j.a)(i,x(t.drawing.elements),n.animateOptions),r=i.outerHTML,a?(c=document.getElementById(a))&&(c.innerHTML=r):(s=window.open("","_blank"))&&(s.document.body.innerHTML=r);case 6:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),w=(n(74),n(0)),k=function(e,t){var n=e.match(new RegExp("".concat(t,":(-?\\d+)")));return null===n?void 0:Number(n[1])||0},S=function(e,t,n,a){var i=Object(c.a)({},e.appState.selectedElementIds);return{elements:e.elements.map((function(e){var r,o=e.id;return t.includes(o)?(r=o.match(new RegExp("".concat(n,":(-?\\d+)")))?o.replace(new RegExp("".concat(n,":(-?\\d+)")),"".concat(n,":").concat(a)):o+"-".concat(n,":").concat(a),o===r?e:(i[r]=i[o],delete i[o],Object(c.a)(Object(c.a)({},e),{},{id:r}))):e})),appState:Object(c.a)(Object(c.a)({},e.appState),{},{selectedElementIds:i})}},C=function(e){var t,n,a=e.animateEnabled,i=e.setAnimateEnabled,r=e.scene,o=e.updateDrawing,s=e.animateOptions,u=e.setAnimateOptions,d=e.previewCurrentScene,l=null!==(t=null===r||void 0===r?void 0:r.drawing.elements)&&void 0!==t?t:[],m=r?Object.keys(null!==(n=r.drawing.appState.selectedElementIds)&&void 0!==n?n:{}).filter((function(e){return r.drawing.appState.selectedElementIds[e]&&l.some((function(t){return t.id===e}))})):[],b=new Set;m.forEach((function(e){b.add(k(e,"animateOrder"))}));var f=!a||!b.size,g=new Set;m.forEach((function(e){g.add(k(e,"animateDuration"))}));var p=!a||!g.size;return Object(w.jsxs)("div",{className:"AnimateConfig",children:[Object(w.jsxs)("div",{children:[Object(w.jsxs)("label",{children:[Object(w.jsx)("input",{type:"checkbox",checked:a,onChange:function(){return i((function(e){return!e}))}}),"Enable animate"]})," ",Object(w.jsx)("button",{disabled:!a,onClick:d,children:"Preview"})]}),Object(w.jsxs)("div",{style:{opacity:f?.3:1},children:["Animate order:"," ",b.size>1?Object(w.jsx)(w.Fragment,{children:"(mixed)"}):Object(w.jsx)("input",{disabled:f,value:1===b.size&&b.values().next().value||0,onChange:function(e){var t=Math.floor(Number(e.target.value));r&&Number.isFinite(t)&&o(S(r.drawing,m,"animateOrder",t))},type:"number",style:{width:40}})]}),Object(w.jsxs)("div",{style:{opacity:p?.3:1},children:["Animate duration (ms):"," ",g.size>1?Object(w.jsx)(w.Fragment,{children:"(mixed)"}):Object(w.jsx)("input",{disabled:p,value:1===g.size&&g.values().next().value||"",onChange:function(e){var t=Math.floor(Number(e.target.value));r&&Number.isFinite(t)&&o(S(r.drawing,m,"animateDuration",t))},placeholder:"Default",style:{width:50}})]}),Object(w.jsxs)("div",{style:{opacity:a?1:.3},children:["Animate pointer:"," ",Object(w.jsx)("input",{disabled:!a,value:s.pointerImg||"",onChange:function(e){u((function(t){return Object(c.a)(Object(c.a)({},t),{},{pointerImg:e.target.value})}))},placeholder:"URL...",style:{width:50}})," ",Object(w.jsxs)("label",{className:"AnimateConfig-button-like ".concat(a?"AnimateConfig-button-like-enabled":"AnimateConfig-button-like-disabled"),children:[Object(w.jsx)("input",{disabled:!a,type:"file",accept:"image/*",onChange:function(e){var t=e.target.files&&e.target.files[0];if(t){var n=new FileReader;n.onload=function(){if("string"===typeof n.result){var e=n.result;u((function(t){return Object(c.a)(Object(c.a)({},t),{},{pointerImg:e})}))}},n.readAsDataURL(t)}},style:{width:0}}),"File"]})]}),Object(w.jsxs)("div",{style:{opacity:a?1:.3},children:["(Pointer width:"," ",Object(w.jsx)("input",{disabled:!a,value:s.pointerWidth||"",onChange:function(e){u((function(t){return Object(c.a)(Object(c.a)({},t),{},{pointerWidth:e.target.value})}))},placeholder:"Num...",style:{width:50}}),")"]})]})},T=n(43),E=n.n(T),I=n(12),A=function(){var e=Object(m.a)(l.a.mark((function e(t,n){var a,i,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.name.endsWith(".excalidraw")){e.next=5;break}return e.next=3,Object(o.loadFromBlob)(t,n,null);case 3:return a=e.sent,e.abrupt("return",Object(c.a)(Object(c.a)({},a),{},{appState:Object(c.a)(Object(c.a)({},n),a.appState)}));case 5:if("image/svg+xml"!==t.type){e.next=10;break}return e.next=8,N(t);case 8:return i=e.sent,e.abrupt("return",{elements:i,appState:n});case 10:if(!t.type.startsWith("image/")){e.next=15;break}return e.next=13,M(t);case 13:return r=e.sent,e.abrupt("return",{elements:r,appState:n});case 15:return console.log("Unsupported file dropped",t),window.alert("Unsupported file dropped"),e.abrupt("return",null);case 18:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),N=function(){var e=Object(m.a)(l.a.mark((function e(t){var n,a,i,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text();case 2:if(n=e.sent,a=E.a.convert(n),i=a.hasErrors,r=a.content,!i){e.next=6;break}throw Error("Error in convertSvgToElements");case 6:return e.abrupt("return",r.elements);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),M=function(){var e=Object(m.a)(l.a.mark((function e(t){var n,a,i,r,c,o,s,u,d,m,f,g,p,v,h,j;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,createImageBitmap(t);case 2:if(n=e.sent,a=64/Math.max(n.width,n.height),(i=document.createElement("canvas")).width=n.width*a,i.height=n.height*a,r=i.getContext("2d")){e.next=10;break}throw Error("Error in convertSvgToElements");case 10:for(r.drawImage(n,0,0,n.width,n.height,0,0,i.width,i.height),c=r.getImageData(0,0,i.width,i.height),o=[],s=Object(I.a)(),u=0;u<i.height;++u)for(d=0;d<i.width;++d)m=c.data.slice(4*(u*i.width+d)),f=Object(b.a)(m,4),g=f[0],p=f[1],v=f[2],h=f[3],j={type:"rectangle",version:1,versionNonce:0,isDeleted:!1,id:Object(I.a)(),fillStyle:"solid",strokeWidth:1,strokeStyle:"solid",roughness:0,opacity:100,angle:0,x:300+5*d,y:100+5*u,strokeColor:"transparent",backgroundColor:"rgba(".concat(g,",").concat(p,",").concat(v,",").concat(h,")"),width:5,height:5,seed:0,groupIds:[s],strokeSharpness:"sharp",boundElementIds:[]},o.push(j);return e.abrupt("return",o);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),L="invert(93%) hue-rotate(180deg)",D=Object(a.memo)((function(e){var t=e.scene,n=e.darkMode,i=Object(a.useRef)(null);return Object(a.useEffect)((function(){if(i.current){var e=i.current.getContext("2d");e&&e.putImageData(t.imageData,0,0)}}),[t]),Object(w.jsx)("canvas",{ref:i,width:t.width,height:t.height,style:{filter:n?L:void 0}})})),B=function(e){var t,n=e.scenes,i=e.currentIndex,r=e.updateScenes,c=e.moveToScene,o=e.addScene,s=e.updateDrawing,d=Object(a.useState)(!1),g=Object(b.a)(d,2),p=g[0],v=g[1],j=Object(a.useState)(!1),x=Object(b.a)(j,2),k=x[0],S=x[1],T=Object(a.useState)({}),E=Object(b.a)(T,2),I=E[0],N=E[1],M="dark"===(null===(t=n[i||0])||void 0===t?void 0:t.drawing.appState.theme),B=Object(a.useRef)();Object(a.useEffect)((function(){B.current=function(){var e=Object(m.a)(l.a.mark((function e(t){var a,r,c,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null===(a=t.dataTransfer)||void 0===a?void 0:a.files[0],c=void 0!==i&&n[i].drawing.appState,!r||!c){e.next=7;break}return e.next=5,A(r,c);case 5:(s=e.sent)&&o(s);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}));var R=function(){var e=Object(m.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h(n);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),F=function(){var e=Object(m.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(n,{darkMode:M,animate:k,animateOptions:I});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),P=function(){var e=Object(m.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===i){e.next=7;break}return t="",(a=document.getElementById("previewOuter"))&&(t="previewInner"),e.next=6,y(n[i],{darkMode:M,animate:k,animateOptions:I},t);case 6:a&&(a.style.display="block");case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){0===n.length&&o()}),[n,o]),Object(w.jsxs)("div",{className:"Claymate",style:{filter:M?L:void 0},ref:function(e){e&&(e.ondrop=function(e){var t;return null===(t=B.current)||void 0===t?void 0:t.call(B,e)})},children:[Object(w.jsx)("div",{className:"Claymate-scenes",children:n.map((function(e,t){var a="MissingId";return Object(f.isEmpty)(n[t].drawing.elements)||(a=n[t].drawing.elements[0].id),Object(w.jsxs)("div",{className:"Claymate-scene ".concat(t===i?"Claymate-current-scene":""),onClick:function(){return c(t)},"data-testid":a,children:[Object(w.jsx)(D,{scene:e,darkMode:M}),Object(w.jsx)("button",{type:"button",className:"Claymate-delete","aria-label":"Delete",disabled:n.length<=1,onClick:function(t){t.stopPropagation(),function(e){var t=n.findIndex((function(t){return t.id===e}));if(t>=0){var a=n.length-1;if(a>0){var c;if(void 0!==i){var o=t===i;if(i>t||o){var s=i;o&&(i===a?s=i-1:0===i&&(s=1)),c={index:i>0?i-1:i,drawing:n[s].drawing}}}r((function(t){return t.filter((function(t){return t.id!==e}))}),c)}}}(e.id)},children:"\u2716"}),Object(w.jsx)("button",{type:"button",className:"Claymate-left","aria-label":"Move Left",disabled:0===t,onClick:function(t){t.stopPropagation(),function(e){var t=n.findIndex((function(t){return t.id===e}));r((function(e){var n=Object(u.a)(e);return n[t-1]=e[t],n[t]=e[t-1],n}),{index:t-1,drawing:n[t].drawing})}(e.id)},children:"\u2b05"}),Object(w.jsx)("button",{type:"button",className:"Claymate-right","aria-label":"Move Right",disabled:t===n.length-1,onClick:function(t){t.stopPropagation(),function(e){var t=n.findIndex((function(t){return t.id===e}));r((function(e){var n=Object(u.a)(e);return n[t+1]=e[t],n[t]=e[t+1],n}),{index:t+1,drawing:n[t].drawing})}(e.id)},children:"\u27a1"})]},e.id)}))}),Object(w.jsx)("div",{className:"Claymate-configs",children:p&&Object(w.jsx)(C,{animateEnabled:k,setAnimateEnabled:S,scene:void 0===i?void 0:n[i],updateDrawing:s,animateOptions:I,setAnimateOptions:N,previewCurrentScene:P})}),Object(w.jsxs)("div",{className:"Claymate-buttons",children:[Object(w.jsx)("button",{type:"button",onClick:function(){return o()},children:"Add scene"}),Object(w.jsx)("button",{type:"button",onClick:R,disabled:0===n.length,children:"Export GIF"}),Object(w.jsxs)("div",{children:[Object(w.jsx)("button",{type:"button",onClick:function(){return v((function(e){return!e}))},children:p?Object(w.jsx)(w.Fragment,{children:"\u25b8"}):Object(w.jsx)(w.Fragment,{children:"\u25c2"})}),Object(w.jsx)("button",{type:"button",onClick:function(){return F()},disabled:0===n.length,children:"Export HTML"})]}),Object(w.jsx)("button",{type:"button",onClick:function(){r((function(e){return Object(u.a)(e).reverse()}),void 0!==i?{index:n.length-1-i,drawing:n[i].drawing}:void 0)},disabled:n.length<=1,children:"Reverse order"})]})]})},R=n(28),F=n.n(R),P=function(e,t){var n=Object(o.exportToCanvas)(e),a=t?t.width:n.width,i=t?t.height:n.height;if(a&&i){var r=n.getContext("2d");return r?{id:Object(I.a)(),width:a,height:i,imageData:r.getImageData(0,0,a,i),drawing:e}:void 0}},z="claymate-scenes",J=function(){try{var e,t=JSON.parse(localStorage.getItem(z)||"");if(t&&t.length>0)return t.map((function(t){t.appState.collaborators=new Map;var n=P(t,e?{width:e.width,height:e.height}:void 0);return void 0===e&&(e=n),n}))}catch(i){try{var n=function(){try{var e=JSON.parse(localStorage.getItem("excalidraw-elements")||"");return e.appState.collaborators=new Map,e}catch(t){return null}}();if(n){var a=P(n);if(a)return[a]}}catch(r){}}return null},W=function(){var e=Object(a.useState)(!1),t=Object(b.a)(e,2),n=t[0],i=t[1],r=Object(a.useState)(0),o=Object(b.a)(r,2),s=o[0],d=o[1],l=Object(a.useState)(0),m=Object(b.a)(l,2),f=m[0],g=m[1],p=Object(a.useState)([]),v=Object(b.a)(p,2),h=v[0],j=v[1],x=Object(a.useState)(),O=Object(b.a)(x,2),y=O[0],w=O[1];Object(a.useEffect)((function(){if(!n){var e=J();e&&e.length>0&&(j(e),g(0),w(e[0].drawing))}}),[n,i]),Object(a.useEffect)((function(){!function(e){var t=JSON.stringify(e.map((function(e){return e.drawing})));localStorage.setItem(z,t)}(h)}),[h]);var k,S,C=Object(a.useCallback)((function(e){d((function(e){return e+1})),w(e)}),[]),T=Object(a.useCallback)((function(e){C(h[e].drawing),g(e)}),[C,g,h]),E=Object(a.useCallback)((function(e,t){j(e),t&&(g(t.index),C(t.drawing))}),[g,C,j]),I=void 0!==f&&f<h.length?Object(c.a)(Object(c.a)({},h[f]),{},{drawing:y}):void 0;null!=I&&1!==h.length&&(k=I.width,S=I.height),Object(a.useEffect)((function(){if(null!=f&&y){var e=P(y,void 0===k||void 0===S?void 0:{width:k,height:S});e&&E((function(t){var n=Object(u.a)(t);return n[f]=e,n}),void 0)}}),[y,f,h.length,E,k,S]);var A=Object(a.useCallback)((function(e){var t=e||y;if(t){var n=P(t,h[0]&&{width:h[0].width,height:h[0].height});n&&E((function(e){return[].concat(Object(u.a)(e),[n])}),{index:h.length,drawing:t})}}),[E,h,y]);return{initialised:n,moveToScene:T,addScene:A,onChange:function(e,t){if(null==y||!F()(e,y.elements)||!F()(t,y.appState)){var n={elements:e.map((function(e){return Object(c.a)({},e)})),appState:Object(c.a)({},t)};w(n)}},drawingVersion:s,currentIndex:f,scenes:h,updateScenes:E,initialData:y}},U="claymate-libraries",H=function(){var e=Object(a.useMemo)((function(){return function(){try{var e=localStorage.getItem(U),t=e?JSON.parse(e):void 0;if(t)return t}catch(n){console.error("Unable to load libraries",n)}}()}),[]),t=Object(a.useRef)(e);return{onLibraryChange:Object(a.useCallback)((function(e){!function(e){var t=JSON.stringify(e);localStorage.setItem(U,t)}(e),t.current=e}),[]),libraryItems:t.current}},V=function(){var e=Object(a.useRef)(null),t=W(),n=t.moveToScene,i=t.addScene,r=t.onChange,o=t.drawingVersion,u=t.currentIndex,d=t.initialData,l=t.scenes,m=t.updateScenes,b=H(),f=b.onLibraryChange,g=b.libraryItems,p=Object(a.useMemo)((function(){return g?Object(c.a)(Object(c.a)({},d),{},{libraryItems:g}):d}),[d,g]);return Object(w.jsxs)("div",{className:"ClaymateApp",children:[Object(w.jsx)(s.a,{ref:e,initialData:p,onChange:r,onLibraryChange:f},o),Object(w.jsx)(B,{scenes:l,currentIndex:u,updateScenes:m,moveToScene:n,addScene:i,updateDrawing:function(t){var n;null===(n=e.current)||void 0===n||n.updateScene(t)}})]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(Object(w.jsx)(a.StrictMode,{children:Object(w.jsx)(V,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},48:function(e,t,n){},72:function(e,t,n){},73:function(e,t,n){},74:function(e,t,n){}},[[143,1,2]]]);
//# sourceMappingURL=main.4c0f5460.chunk.js.map